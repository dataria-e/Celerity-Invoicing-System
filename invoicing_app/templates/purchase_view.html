{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <div class="d-flex gap-2">
    <a href="{{ url_for('purchases_page') }}" class="btn btn-sm">Back</a>
    <a href="{{ url_for('edit_purchase_page', purchase_id=purchase.id) }}" class="btn btn-sm">Edit</a>
  </div>
  <button type="button" class="btn btn-sm btn-primary" onclick="window.print()">Print</button>
</div>

<div class="card" id="purchasePrintArea">
  <div class="card-body p-4 p-md-5">
    <div class="d-flex justify-content-between align-items-start mb-4">
      <div>
        <h1 class="h2 mb-1">Purchase {{ purchase.purchase_number }}</h1>
        <div class="text-muted">Date: {{ purchase.purchase_date }}</div>
      </div>
      <div class="text-end">
        <div class="fw-semibold">Celerity</div>
        <div class="text-muted">Purchase Invoice</div>
      </div>
    </div>

    <div class="row mb-4">
      <div class="col-12 col-md-6 mb-3 mb-md-0">
        <div class="text-uppercase text-muted fw-bold small mb-2">Company</div>
        <div>Celerity</div>
      </div>
      <div class="col-12 col-md-6">
        <div class="text-uppercase text-muted fw-bold small mb-2">Vendor</div>
        <div><strong>{{ purchase.vendor_name or '-' }}</strong></div>
        <div>Tax Number: {{ purchase.vendor_tax_number or '-' }}</div>
        <div>Registration: {{ purchase.registration_name or '-' }}</div>
        <div>Phone: {{ purchase.phone_number or '-' }}</div>
        <div>Website: {{ purchase.website or '-' }}</div>
        <div>Country: {{ purchase.country or '-' }}</div>
        <div>{{ purchase.address or '-' }}</div>
        <div>{{ purchase.address_2 or '' }}</div>
      </div>
    </div>

    <div class="table-responsive mb-4">
      <table class="table table-transparent table-responsive">
        <thead>
          <tr>
            <th class="text-center" style="width: 40px">#</th>
            <th>Item</th>
            <th class="text-end">Quantity</th>
            <th class="text-end">Unit</th>
            <th class="text-end">Price</th>
            <th class="text-end">VAT %</th>
            <th class="text-end">Amount</th>
          </tr>
        </thead>
        <tbody>
          {% for line in purchase_items %}
          <tr>
            <td class="text-center">{{ loop.index }}</td>
            <td>{{ line.item_name }}</td>
            <td class="text-end">{{ '%.2f'|format(line.quantity) }}</td>
            <td class="text-end">{{ line.unit or '-' }}</td>
            <td class="text-end">{{ '%.2f'|format(line.price) }}</td>
            <td class="text-end">{{ '%.2f'|format(line.vat_amount) }}%</td>
            <td class="text-end">{{ '%.2f'|format(line.line_total) }}</td>
          </tr>
          {% else %}
          <tr>
            <td colspan="7" class="text-muted text-center py-4">No purchase items.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <div class="row justify-content-end">
      <div class="col-12 col-md-6 col-lg-5">
        <table class="table table-transparent">
          <tr><td class="text-end text-muted">Subtotal</td><td class="text-end">{{ '%.2f'|format(purchase.subtotal) }}</td></tr>
          <tr>
            <td class="text-end text-muted">VAT Rate</td>
            <td class="text-end">{% if purchase.subtotal and purchase.subtotal > 0 %}{{ '%.2f'|format((purchase.vat_total / purchase.subtotal) * 100) }}%{% else %}0.00%{% endif %}</td>
          </tr>
          <tr><td class="text-end text-muted">VAT Due</td><td class="text-end">{{ '%.2f'|format(purchase.vat_total) }}</td></tr>
          <tr><td class="text-end fw-bold">TOTAL</td><td class="text-end fw-bold">{{ '%.2f'|format(purchase.total) }}</td></tr>
        </table>
      </div>
    </div>
  </div>
</div>

<style>
  @media print {
    .sidebar, .topbar, .btn, .page-content > .d-flex:first-child { display: none !important; }
    .main-content { margin-left: 0 !important; }
    .page-content { padding: 0 !important; }
    #purchasePrintArea { border: none !important; box-shadow: none !important; }
  }
</style>
{% endblock %}
